{"version":3,"sources":["../../src/tasks/clean.js"],"names":["clean","envs","task","succeed","diff","sync","filter","path","includes","substr","length","log","join","subtask","some","startsWith","Error","done"],"mappings":";;;;;kBAIwBA,K;;AAJxB;;AACA;;;;AACA;;;;;;AAEe,SAASA,KAAT,CAAeC,IAAf,EAAqB;AAClC,QAAMC,OAAO,mBAAS,OAAT,CAAb;;AAEA,MAAI,CAACD,IAAL,EAAW;AACT,iCAAS,wCAAT;AACAC,SAAKC,OAAL;AACA;AACD;;AAED,QAAMC,OAAO,eAAKC,IAAL,CAAU,MAAV,EAAkBC,MAAlB,CAAyBC,QAAQ,CAACN,KAAKO,QAAL,CAAcD,KAAKE,MAAL,CAAY,OAAOC,MAAnB,CAAd,CAAlC,CAAb;AACA,MAAIN,KAAKM,MAAT,EAAiB;AACf,UAAMC,MAAO,aAAYP,KAAKQ,IAAL,CAAU,GAAV,CAAe,EAAxC;AACA,UAAMC,UAAUX,KAAKW,OAAL,CAAaF,GAAb,CAAhB;AACA,QAAIP,KAAKU,IAAL,CAAUV,QAAQA,KAAKW,UAAL,CAAgB,KAAhB,CAAlB,CAAJ,EAA+C;AAC7C,YAAM,IAAIC,KAAJ,CAAU,qBAAV,CAAN;AACD;;AAED,iCAAU,UAASZ,KAAKQ,IAAL,CAAU,GAAV,CAAe,EAAlC;AACAC,YAAQI,IAAR;AACD;;AAEDf,OAAKC,OAAL;AACD","file":"clean.js","sourcesContent":["import { execSync } from 'child_process';\nimport glob from 'glob';\nimport Task from '../task/';\n\nexport default function clean(envs) {\n  const task = new Task('clean');\n\n  if (!envs) {\n    execSync('rm -Rf lib-* test/node6 examples/node6');\n    task.succeed();\n    return;\n  }\n\n  const diff = glob.sync('lib*').filter(path => !envs.includes(path.substr('lib-'.length)));\n  if (diff.length) {\n    const log = `removing: ${diff.join(',')}`;\n    const subtask = task.subtask(log);\n    if (diff.some(diff => diff.startsWith('src'))) {\n      throw new Error('Cannot contains src');\n    }\n\n    execSync(`rm -Rf ${diff.join(' ')}`);\n    subtask.done();\n  }\n\n  task.succeed();\n}\n"]}